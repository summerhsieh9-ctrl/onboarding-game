<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å¸æ–°äººå†’éšªä¹‹æ—… 2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #3498db; --secondary: #e67e22; --success: #2ecc71; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f6; margin: 0; padding: 20px; }
        .game-card { max-width: 500px; margin: 40px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        
        /* é€²åº¦æ¢ */
        .progress-container { background: #eee; border-radius: 20px; height: 20px; margin: 25px 0; overflow: hidden; position: relative; }
        .progress-bar { background: linear-gradient(90deg, #2ecc71, #27ae60); width: 0%; height: 100%; transition: 1s ease-out; }
        #percentText { position: absolute; width: 100%; text-align: center; font-size: 12px; line-height: 20px; color: #333; font-weight: bold; }

        /* ä»»å‹™æ¸…å–® */
        .task-group { margin-top: 20px; }
        .task-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f0f0f0; transition: 0.3s; }
        .task-item:last-child { border: none; }
        .task-item input { margin-right: 15px; width: 22px; height: 22px; cursor: pointer; }
        .completed-text { text-decoration: line-through; color: #bdc3c7; }

        /* å¬å–šæŒ‰éˆ•èˆ‡å½ˆçª— (æ²¿ç”¨ä¹‹å‰æ¨£å¼) */
        .summon-btn { position: fixed; bottom: 30px; right: 30px; width: 80px; height: 80px; border-radius: 50%; 
                      background: var(--secondary); color: white; border: none; cursor: pointer; font-weight: bold;
                      box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4); z-index: 100; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 200; }
        .modal-content { background: white; width: 350px; margin: 100px auto; padding: 25px; border-radius: 15px; text-align: center; }
        textarea { width: 100%; margin: 15px 0; padding: 10px; box-sizing: border-box; border-radius: 8px; border: 1px solid #ddd; }
        .send-btn { background: var(--success); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; }
    </style>
</head>
<body>

<div class="game-card">
    <h1>ğŸ›¡ï¸ æ–°äººè©¦ç…‰å†’éšª</h1>
    <p style="text-align: center; color: #7f8c8d;">å†’éšªç­‰ç´šï¼š<span id="levelText">æ–°æ‰‹æ‘æ°‘</span></p>
    
    <div class="progress-container">
        <div id="percentText">0%</div>
        <div id="pBar" class="progress-bar"></div>
    </div>

    <div class="task-group" id="taskList">
        <div class="task-item"><input type="checkbox" id="t1" onchange="update()"> <span>[ç¬¬ä¸€é€±] èˆ‡å°å¸«é€²è¡Œ 1-on-1 è¨ªè«‡</span></div>
        <div class="task-item"><input type="checkbox" id="t2" onchange="update()"> <span>[ç¬¬ä¸€æœˆ] åƒèˆ‡ä¸¦è§€å¯Ÿä¸€æ¬¡æ­£å¼æœƒè­°</span></div>
        <div class="task-item"><input type="checkbox" id="t3" onchange="update()"> <span>[ç¬¬äºŒæœˆ] å®Œæˆç¬¬ä¸€ä»½å€‹äººå°ˆæ¡ˆå ±å‘Š</span></div>
        <div class="task-item"><input type="checkbox" id="t4" onchange="update()"> <span>[ç¬¬ä¸‰æœˆ] æäº¤é©æ‡‰æœŸå›é¥‹ä¸¦é€šéè€ƒæ ¸</span></div>
    </div>
</div>

<button class="summon-btn" onclick="openModal()">å¬å–š<br>å°å¸«</button>

<div id="mentorModal" class="modal">
    <div class="modal-content">
        <h3>ğŸ§™â€â™‚ï¸ å°å¸«å¬å–šé™£</h3>
        <textarea id="msg" rows="4" placeholder="å†’éšªè€…ï¼Œæè¿°ä½ çš„å›°æƒ‘..."></textarea>
        <button class="send-btn" onclick="sendRequest()">æ­£å¼ç™¼é€å¬å–šä»¤</button>
        <p onclick="closeModal()" style="margin-top: 15px; color: #95a5a6; cursor: pointer;">æš«æ™‚æ’¤é€€</p>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwOONb7tyXbK9OQAl0qrbp2HHLQ6pyyK7qPaHGvKp95utPd0GeRImD6ZmmcbZBEIAgu/exec'; // ğŸ‘ˆ è¨˜å¾—è²¼å›ä½ çš„ç¶²å€ï¼

    // ç•¶é é¢è¼‰å…¥æ™‚ï¼Œå¾ç€è¦½å™¨å–å‡ºèˆŠç´€éŒ„
    window.onload = function() {
        const savedData = JSON.parse(localStorage.getItem('newbieProgress') || '{}');
        Object.keys(savedData).forEach(id => {
            const el = document.getElementById(id);
            if(el) el.checked = savedData[id];
        });
        update();
    };

    function update() {
        const checks = document.querySelectorAll('input[type="checkbox"]');
        const checked = document.querySelectorAll('input[type="checkbox"]:checked');
        const progress = (checked.length / checks.length) * 100;

        // æ›´æ–°é€²åº¦æ¢èˆ‡æ–‡å­—
        document.getElementById('pBar').style.width = progress + '%';
        document.getElementById('percentText').innerText = Math.round(progress) + '%';
        
        // æ›´æ–°ç¨±è™Ÿ
        const levelText = document.getElementById('levelText');
        if(progress === 100) {
            levelText.innerText = "ğŸ† æ¦®è€€é¨å£« (ä»»å‹™é”æˆï¼)";
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); // è§¸ç™¼ç‘èŠ±
        } else if (progress >= 50) { levelText.innerText = "âš”ï¸ è¦‹ç¿’æˆ°å£«"; }
        else { levelText.innerText = "æ–°æ‰‹æ‘æ°‘"; }

        // [A] é€²åº¦è¨˜æ†¶ï¼šå°‡å‹¾é¸ç‹€æ…‹å­˜å…¥ localStorage
        const status = {};
        checks.forEach(el => status[el.id] = el.checked);
        localStorage.setItem('newbieProgress', JSON.stringify(status));

        // åˆ‡æ›æ–‡å­—åŠƒç·šæ¨£å¼
        checks.forEach(el => {
            el.nextElementSibling.classList.toggle('completed-text', el.checked);
        });
    }

    // å½ˆçª—èˆ‡å¯„ä¿¡é‚è¼¯ (æ²¿ç”¨ä¹‹å‰çš„)
    function openModal() { document.getElementById('mentorModal').style.display = 'block'; }
    function closeModal() { document.getElementById('mentorModal').style.display = 'none'; }

    async function sendRequest() {
        const msg = document.getElementById('msg').value;
        if(!msg) return alert("è«‹å¡«å¯«å•é¡Œå…§å®¹");
        const btn = document.querySelector(".send-btn");
        btn.innerText = "å‚³é€ä¸­..."; btn.disabled = true;

        try {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ message: msg }) });
            alert("âœ¨ å¬å–šæˆåŠŸï¼");
            document.getElementById('msg').value = "";
            closeModal();
        } catch (e) { alert("ç™¼é€å¤±æ•—"); }
        finally { btn.innerText = "æ­£å¼ç™¼é€å¬å–šä»¤"; btn.disabled = false; }
    }
</script>

</body>
</html>